<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>FunctionExplanation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="An application to automatically count cells using wavelet transformation"/>
    <meta name="author" content="Jonathan Ott"/>

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>
    <meta http-equiv="X-UA-Compatible" content="IE=11" >
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link type="text/css" rel="stylesheet" href="/CellCounter/content/style.css" /> <!--/CellCounter-->
    <link type="text/css" rel="stylesheet" href="/CellCounter/styles/CSBStyles.css" /> <!--/CellCounter-->
    <script type="text/javascript" src="/CellCounter/content/tips.js"></script> <!--/CellCounter-->
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="https://github.com/Joott/CellCounter">github page</a></li>
        </ul>
        <h3 class="muted"><a href="/CellCounter/index.html">CellCounter</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h2><a name="Calculating-Dimensions" class="anchor" href="#Calculating-Dimensions">Calculating Dimensions</a></h2>
<p>The functions in this library require two different dimensions in pixels. Since pixels are not "real" parameters, here are two functions to calculate
the dimensions from parameters given by the equipment.</p>
<p>The first parameter needed is the dimension of a square under the counting chamber. The function to calculate that for an improved Neubauer counting chamber is:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="id">Filter</span><span class="pn">.</span><span class="id">squareCalculator</span> <span class="id">cameraPixelSize</span> <span class="id">binning</span> <span class="id">magnification</span> <span class="id">cameraMount</span>
</code></pre></td>
</tr>
</table>
<p>Camera pixel size is usually given in A x A microns. A is inserted as a parameter for the function. Binning is also mostly given in a B x B format, where a B
is the parameter taken. Magnification represents the magnification of the microscope, usually a 20x or 40x. Camera mount is an additional possible source of magnification,
mostly a 1x, but sometimes a different modification and has to be taken into account. This function fills the height and width part of the processImage function.</p>
<h3><a name="Important-note-about-the-pictures" class="anchor" href="#Important-note-about-the-pictures">Important note about the pictures</a></h3>
<p>The pictures are taken from a part of the counting chamber, where no lines are present. The function automatically takes a part from the middle of the picture with a size corresponding to
the squares of the counting chamber. Therefore no lines are needed and only influence the result negatively!</p>
<p>The second parameter needed is the radius for the wavelet function in pixels. It corresponds to the diameter of the cells to be counted. The function takes
nearly the same input as the previous one, except that its first parameter is the diameter of the cells in microns.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="id">Filter</span><span class="pn">.</span><span class="id">cellRadiusCalculator</span> <span class="id">cellDiameter</span> <span class="id">cameraPixelSize</span> <span class="id">binning</span> <span class="id">magnification</span> <span class="id">cameraMount</span>
</code></pre></td>
</tr>
</table>
<h2><a name="Processing-Images" class="anchor" href="#Processing-Images">Processing Images</a></h2>
<p>The function processImage is a function which combines all processing functions in the correct order for one single image and analyzes a square in the center of the picture with the size of
a square from the counting chamber. It also serves rather as an example of how to use the functions, since it can be modified in several ways, which are detailed below.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="id">Pipeline</span><span class="pn">.</span><span class="id">processImage</span> <span class="id">filePath</span> <span class="id">height</span> <span class="id">width</span> <span class="id">radius</span> <span class="id">thresholdMultiplier</span>
</code></pre></td>
</tr>
</table>
<p>filePath is the path of the image. Height and width can be filled with the same result from the Filter.squareCalculator. Radius gets the result from Filter.cellRadiusCalculator.
thresholdMultiplier is a multiplier for the cutoff after the wavelet transformation. It has to be higher the closer in intensity the background to the cells is. The threshold function in the
pipeline contains a boolean for determining whether the cells have a positive or negative value. In all cases so far the intensities were negative. If for some reason they are positive,
the boolean has to be changed to "true". The chart which is returned in the resulting tuple serves visualization purposes. This functionality can be removed without consequences. To view the chart
you have to open FSharp.Plotly and use the command Chart.Show.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="id">Pipeline</span><span class="pn">.</span><span class="id">processImages</span> <span class="id">folderPath</span> <span class="id">height</span> <span class="id">width</span> <span class="id">radius</span> <span class="id">thresholdMultiplier</span>
</code></pre></td>
</tr>
</table>
<p>This function is a convenience function which applies the previous function to a whole folder with images. It takes a folderpath instead of the filepath and processes all
images in that folder.</p>
<h2><a name="Possible-Variants" class="anchor" href="#Possible-Variants">Possible Variants</a></h2>
<p>The threshold function currently used in the Pipeline.processImage is based on the maximum intensities in the pictures. An alternative threshold function exists which is based on a percentile cutoff. It can be used
in place of the other function, although its performance is worse with changing cell numbers.</p>
<p>To count cells in petri dishes, the Filter.rectangleSelectorCenter function in the pipeline has to be replaced with:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="id">Filter</span><span class="pn">.</span><span class="id">circleSelector</span> <span class="id">pointAXY</span> <span class="id">pointBXY</span>
</code></pre></td>
</tr>
</table>
<p>This function takes two opposing points on a circle in the format (X-coordinate1, Y-coordinate1) (X-coordinate2, Y-coordinate2).
Those coordinates can be read from the picture directly. This input would then replace height and width. If for some reason the square shouldn't be in the middle
of the picture, following function can be used:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="id">Filter</span><span class="pn">.</span><span class="id">rectangleSelector</span> <span class="id">upperLeftXY</span> <span class="id">lowerRightBXY</span>
</code></pre></td>
</tr>
</table>
<p>It has a similar input format as the Filter.circleSelector, except it takes the upper left and lower right points of the rectangle.</p>
<h2><a name="Misc" class="anchor" href="#Misc">Misc</a></h2>
<p>The functions in the modules Maxima and Image are adapted from the <a href="https://github.com/CSBiology/BioFSharp">BioFSharp</a> library, an open source bioinformatics toolbox written in F#.
The functions were modified to fit the needs of the Cell Counter.</p>

<div class="tip" id="fs1">namespace Microsoft.FSharp</div>

        </div>
        <div class="span3">
          <img src="/CellCounter/img/logo.png" alt="F# Project" style="width:150px;margin:10px" />  
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
              <li class="nav-header">CellCounter</li>
              <li><a href="/CellCounter/index.html">Home page</a></li>
              <li class="divider"></li>
              <li><a href="https://github.com/Joott/CellCounter">Source Code on GitHub</a></li>
              <li><a href="/CellCounter/license.html">License</a></li>
              <li><a href="/CellCounter/release-notes.html">Release Notes</a></li>

              <li class="nav-header">Getting started</li>
              <li><a href="/CellCounter/FunctionExplanation.html">Function Explanation</a></li>
              <li><a href="/CellCounter/DilutionExperiment.html">Counting Experiment</a></li>

              <li class="nav-header">Documentation</li>
              <li><a href="/CellCounter/reference/index.html">API Reference</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="https://github.com/Joott/CellCounter"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
